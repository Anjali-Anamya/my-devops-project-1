  apply-sealed-secrets:
    name: Apply Sealed Secrets
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install kubeseal
        run: |
          wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.23.0/kubeseal-0.23.0-linux-amd64.tar.gz
          tar -xzf kubeseal-0.23.0-linux-amd64.tar.gz
          chmod +x kubeseal
          sudo mv kubeseal /usr/local/bin/

      - name: Configure kubeconfig
        run: |
          echo "${KUBECONFIG}" > kubeconfig.yaml
          export KUBECONFIG=$PWD/kubeconfig.yaml
          kubectl get nodes
        env:
          KUBECONFIG: ${{ secrets.KUBECONFIG }}

      - name: Apply Sealed Secret
        run: |
          export KUBECONFIG=$PWD/kubeconfig.yaml
          kubectl apply -f sealed-secret.yaml --validate=false
